<html>
  <head>
    <script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <link rel="import" href="bower_components/voice-elements/dist/voice-player.html">
    <link rel="import" href="bower_components/voice-elements/dist/voice-recognition.html">
  </head>
  <body>
    <h1>Table tennis scoring apps</h1>
    <p id="speech" ></p>
    <p id="all-speech" style="display:none;"></p>
    <span id="blue" style="color: blue;"></span>
    <span id="red" style="color: red;"></span>
    <voice-player id="speaker" autoplay text="Welcome to the tt scoring app"></voice-player>
    <voice-recognition id="recognition-element"></voice-recognition>

<script>
var element = document.querySelector('#recognition-element');
var speaker = document.querySelector('#speaker');
var speech = document.querySelector('#speech');
var all = document.querySelector('#all-speech');
var blue = document.querySelector('#blue');
var red = document.querySelector('#red')
element.start();

var reset = function() {
  blue.innerHTML = '0';
  red.innerHTML = '0';
}

var adjustScore = function(text) {
  var scored = false;
  if (/(sky|score) blue/i.test(text)) {
    blue.innerHTML = parseInt(blue.innerHTML) + 1;
    scored = true;
  }

  if (/((sky|score) red|skyrim)/i.test(text)) {
    red.innerHTML = parseInt(red.innerHTML) + 1;
    scored = true;
  }

  if (scored) {
    speaker.setAttribute('text', 'Blue ' + blue.innerHTML + '. Red ' + red.innerHTML);
    speaker.speak();
  }
}

// Change to use interim text and have a timeout when updating scores
element.addEventListener('result', function(e) {
    var textContent = e.detail.result;
    var newText = textContent.replace(all.innerHTML + ' ','');
    speech.innerHTML = newText;
    adjustScore(newText);
    all.innerHTML = e.detail.result;
});


reset();
adjustScore('score blue');
adjustScore('score red');
</script>
  </body>
</html>
